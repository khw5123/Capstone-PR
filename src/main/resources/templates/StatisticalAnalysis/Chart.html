<!DOCTYPE html>
<html lang="en">
<head>
    <title>귀농 귀촌 길잡이</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <link rel="icon" sizes="48x48" href="/icons/returnFarmIcon48.png" />
    <link rel="manifest" href="manifest.webmanifest" />
    <script src="https://s3.amazonaws.com/stitch-sdks/js/bundles/4.6.0/stitch.js"></script>
    <script src="https://unpkg.com/@mongodb-js/charts-embed-dom"></script>

</head>
<body>

<h1>몽고 차트 페이지</h1>

<div id="chart-container" v-cloak>

<!--    <form id="app-form" v-cloak v-on:submit.prevent="request" name = "price_info" accept-charset="utf-8">-->
    <form v-cloak name = "price_info" accept-charset="utf-8">

        <select class="col-sm-2 col-xs-11 my" id="city-filter" name="city" title="시군구 선택" ref="city">
            <option value="" selected="selected">전국</option>
            <option value="성주군">성주군</option>
            <option value="정읍시">정읍시</option>
        </select>

        <select class="col-sm-2 col-xs-11 my" id="cost-filter" name="cost" title="연간 투자비 + 운영비 (만원)" ref="cost">
            <option value='["",""]' selected="selected">전체</option>
            <option value='["",""]'>1</option>
            <option value='["",""]'>2</option>
        </select>

<!--        <input id="refresh" class="col-sm-1 col-xs-11 my" type = "submit" value = "조회"/>-->

    </form>

    <br>

    <div id="chart"></div>

</div>

<script>

    async function renderChart() {
        const sdk = new ChartsEmbedSDK({
            baseUrl: "https://charts.mongodb.com/charts-crop-recommender-mfumo"
        });

        const chart = sdk.createChart({
            chartId: "1d7f71e1-5f77-416e-9361-82f5e82e6fd8",
            height: "500px",
            width: "700px",
            // filter: { "average_income": { "$eq": "3.4E7" } }
            // filter: { "item": { "$eq": "인삼" } }
        });
        await chart.render(document.getElementById("chart"));

        city = "";
        cost = ["",""];

        // $("#refresh").on("click", () => {
        //     chart.refresh();
        // });
        $("#city-filter").on("change", e => {
            // const city = e.target.value;
            city = e.target.value;
            chart.setFilter( {
                $and: [
                    (city ? {"city": city} : {}),
                    // (cost[0] ? {"province": cost[0]} : {})
                ]
            } );
            // city
            //     ? chart.setFilter({ "city": city })
            //     : chart.setFilter({});
        });
        $("#cost-filter").on("change", e => {
            cost = JSON.parse(e.target.value);
            chart.setFilter( {
                $and: [
                    (city ? {"city": city} : {}),
                    // (cost[0] ? {"province": cost[0]} : {})
                ]
            } );
        });
    }

    renderChart().catch(e => window.alert(e.message));

</script>

</body>
</html>